<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./assets/helpers.css">
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="stylesheet" href="./assets/desktop.css">
    <link rel="stylesheet" href="./assets/mobile.css">
    <title>Ido Kabelly</title>
</head>
<body>
    <main>
        <section class="img-section flex justify-center">
            <img id="profile-pic" src="./assets/img/profile-pic-lazy-worst.jpg" alt="">
            <div id="nav" class="navigator">
                <img src="./assets/img/arrow-down.gif" alt="">
            </div>
        </section>
        <section class="profile-section flex justify-center">
            <div class="profile-section-content">
                <div class="header">
                    <h1 class="profile-title">
                        Ido Kabelly
                    </h1>
                    <h3 class="profile-subtitle">
                        a NodeJS Fullstack Developer
                    </h3>
                </div>
                <div class="hr"></div>
                <div class="profile-body flex space-between">
                    <div class="text">
                        <div class="profile-body-subtitle">
                            About Me
                        </div>
                        <p class="content">
                            Experienced web developer, with
                            over 2 years of development
                            background in JavaScript environment:
                            NodeJs services and VueJS as frontend.
                            I also posses basic knowledge with react.
                            Highly motivated, quality driven, a
                            fast learner, with excellent
                            collaboration and communication
                            skills. Passionate about technology
                            and good user experience.
                        </p>
                    </div>
                    <div class="mevn-img flex justify-center align-center">
                        <img src="./assets/img/mevn.png" alt="">
                    </div>
                    <div class="text">
                        <div class="profile-body-subtitle">
                            Details
                        </div>
                        <p class="content">
                            <div class="name">
                                <div class="details-subtitle">
                                    Name:
                                </div>
                                <div>
                                    Eedoh (Ido) Kabelly
                                </div>
                            </div>
                            <div class="age">
                                <div class="details-subtitle">
                                    Age:
                                </div>
                                <div>
                                    <span id="age">...</span>
                                </div>
                            </div>
                            <div class="location">
                                <div class="details-subtitle">
                                    Location:
                                </div>
                                <div>
                                    Tel Aviv, Israel
                                </div>
                            </div>
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
<script>
    window.onload = function(){
        new PageSetup();
    }
    var FIXED = 'fixed';
    var PROFILE_PIC_SRC_ARR = [
        'profile-pic-lazy-worst.jpg', 
        'profile-pic-lazy.png',
        'profile-pic.png'
    ];

    function PageSetup(){
        var state = {
            profilePicLoadingPhase: 0,
            isMobile: window.innerWidth <= 640
        }
        main();

        function main(){
            var imgHeight = setImg();
            if(!state.isMobile){
                window.onscroll = function(event){
                    handleScroll(event, imgHeight);
                }
            }
            document.querySelector('#nav').addEventListener('click', function(){
                    onNavClick(imgHeight);
                });
            setBirthDate();
        }

        function setImg(){
            handleLazyLoading();
            var imgHeight = document.querySelector('#profile-pic').height;
            var picSection = document.querySelector('section.img-section');
            if(picSection){
                picSection.setAttribute('style', `max-height: ${imgHeight}px; height: ${imgHeight}px;`);
            }
            return imgHeight;
        }

        function handleScroll(event, imgHeight){
            var profilePic = document.querySelector('#profile-pic');
            var nav = document.querySelector('#nav');
            var height = window.innerHeight + window.pageYOffset;
            if(height < imgHeight && profilePic.style.position === FIXED){
                profilePic.setAttribute('style', `position: absolute;`);
                nav.setAttribute('style', `position: fixed;`);
            }
            if(height > imgHeight && profilePic.style.position !== FIXED){
                profilePic.setAttribute('style', `position: fixed; top: calc(100vh - ${imgHeight}px);`);
                nav.setAttribute('style', `position: absolute;`);
            }
        }

        function onNavClick(imgHeight){
            window.scrollTo({ top: imgHeight, behavior: 'smooth' });
        }

        function calcAge(){
            var timeDiff = Math.abs(new Date().getTime() - new Date('12/28/1991').getTime());
            return Math.floor(Math.ceil(timeDiff / (1000 * 3600 * 24)) / 365);
        }

        function setBirthDate(){
            var age = calcAge();
            document.getElementById('age').innerHTML = age;
        }

        function handleLazyLoading(){
            const pic = document.querySelector('#profile-pic');
            if(pic.complete){
                profilePicLoaded(pic);
            }
            pic.onload = function(){
                profilePicLoaded(pic);
            }
        }

        function profilePicLoaded(pic){
            state.profilePicLoadingPhase++;
            if(PROFILE_PIC_SRC_ARR[state.profilePicLoadingPhase]){
                pic.src = `./assets/img/${PROFILE_PIC_SRC_ARR[state.profilePicLoadingPhase]}`;
            }
        }
    }
</script>
</html>